jQuery(document).ready(function(t){t(document).keyup(function(a){39===a.keyCode?t("#lightbox-next").click():37===a.keyCode?t("#lightbox-prev").click():27===a.keyCode&&t("#lightbox-close").click()}),t(document).on("click",".resync_close",function(a){a.preventDefault(),t("#resync_popup").remove()}),t(document).on("click",".resync",function(a){a.preventDefault();var e='<div id="resync_popup"><span class="resync_close">X</span><iframe class="resync_container" src="'+t(this).data("href")+'"></iframe></div>';t("body").append(e)}),t(document).on("click",".ajax-link",function(a){a.preventDefault();var e=t(this).data("href"),i=t(this).data("target");t(this).data("folder")&&t("#viewing").html("Viewing: "+unescape(t(this).data("folder"))),t(i).html("").css("opacity","0.5").css("display","none"),t("#lightbox-loading").css("display","block"),t.ajax({url:e,cache:!1}).done(function(a){t(i).html(a).css("opacity","1");var e=0,n=t(".gallery-image").length;function o(){e==n&&(t("#lightbox-loading").css("display","none"),t(i).css("display","block"))}0==n&&o(),t(".gallery-image").on("load",function(){e++,o()}).on("error",function(){e++,o()})})}),t(document).on("click",".ajax-image",function(a){a.preventDefault();t(this).data("gallery");var e=t(this).data("file"),i=t(this).data("folder"),n=t(this).data("exif"),o=t(this).attr("href"),s=t(this).data("number"),d=t(this).data("total"),l=t(this).data("ext"),c=t(this).data("db-id"),r=t(this).data("description"),h=t(this).data("tags"),g="";t("#lightbox").css("display","block"),t("#lightbox-loading").css("display","none"),l=o.substr(o.lastIndexOf(".")+1).toLowerCase(),t("#lightbox-content").html(""),g="jpg"==l||"png"==l||"gif"==l?'<img src="'+o+'" id="lightbox-image">':"mp4"==l?'<video controls class="lightbox-image"><source src="'+o+'" type="video/mp4"></video>':'<span class="lightbox-image">Unsupported file, please re-sync the gallery to convert this file.</span>',t("#lightbox-content").html(g),t("#lightbox-caption-text").html(n),t("#lightbox-caption-description").html(atob(r));var u=atob(h);u=JSON.parse(u),u=JSON.parse(u);var m="";t.each(u,function(t,a){var e='<span class="tag">'+a.tag+"</span>";m+=e}),t("#lightbox-caption-tags").html(m);var f=s+1,p=s-1;function v(){t("#lightbox-loading").css("display","none"),t("#lightbox-content img").css("display","block")}t("#lightbox-next").data("folder",t("#image-"+f).data("folder")).data("gallery",t("#image-"+f).data("folder")).data("exif",t("#image-"+f).data("exif")).attr("href",t("#image-"+f).attr("href")).data("number",t("#image-"+f).data("number")).data("total",t("#image-"+f).data("total")).data("db-id",t("#image-"+f).data("db-id")).data("description",t("#image-"+f).data("description")).data("tags",t("#image-"+f).data("tags")).data("file",t("#image-"+f).data("file")),t("#lightbox-prev").data("folder",t("#image-"+p).data("folder")).data("gallery",t("#image-"+p).data("folder")).data("exif",t("#image-"+p).data("exif")).attr("href",t("#image-"+p).attr("href")).data("number",t("#image-"+p).data("number")).data("total",t("#image-"+p).data("total")).data("db-id",t("#image-"+p).data("db-id")).data("description",t("#image-"+p).data("description")).data("tags",t("#image-"+p).data("tags")).data("file",t("#image-"+p).data("file")),t("#edit_description").data("db-id",c).data("folder-name",i).data("file-name",e).data("number",s),t("#edit_tags").data("db-id",c).data("folder-name",i).data("file-name",e).data("number",s),t("#lightbox-download-link").attr("href",o),s==d?t("#lightbox-next").css("opacity","0.5"):t("#lightbox-next").css("opacity","1"),1==s?t("#lightbox-prev").css("opacity","0.5"):t("#lightbox-prev").css("opacity","1"),t("#lightbox-content img").on("load",function(){v()}).on("error",function(){v()})}),t(document).on("click","#lightbox-close",function(){t("#lightbox").css("display","none"),t("#lightbox-content").html("")}),t(document).on("click","#lightcase-prev",function(){}),t(document).on("click","#edit_description",function(){var a=t(this).data("ajax-url"),e=t(this).data("file-name"),i=t(this).data("folder-name"),n=t(this).data("number");a=a+"file="+encodeURIComponent(e)+"&folder="+encodeURIComponent(i)+"&number="+encodeURIComponent(n);t.ajax({url:a,cache:!1}).done(function(a){t("#lightbox-caption-description").html(a)}).fail(function(t){alert("Ajax loading failed")})}),t(document).on("click","#edit_tags",function(){var a=t(this).data("ajax-url"),e=t(this).data("file-name"),i=t(this).data("folder-name"),n=t(this).data("number");a=a+"file="+encodeURIComponent(e)+"&folder="+encodeURIComponent(i)+"&number="+encodeURIComponent(n);t.ajax({url:a,cache:!1}).done(function(a){t("#lightbox-caption-tags").html(a)}).fail(function(t){alert("Ajax loading failed")})}),t(document).on("submit",".ajax-form",function(a){a.preventDefault();var e=t(this).data("target"),i=t(this).attr("method"),n=t(this).children('input[type="submit"]');n.css("display","none");var o=t(this).attr("id");if("edit_description_form"==o)var s=t(this).children('textarea[name="description"]').val(),d=t(this).children('input[name="number"]').val();else if("edit_tags_form"==o){t("#add_tags_input").trigger("add_tag");var l=t("input[name='tags[]']").map(function(){return t(this).val()}).get();let a=[];l.forEach(function(t,e){var i={tag:t};a.push(i)}),l=JSON.stringify(a);d=t(this).children('input[name="number"]').val()}var c=new FormData(this),r=t(this).data("url");t.ajax({type:i,url:r,data:c,processData:!1,contentType:!1}).done(function(a){if(t(e).html(a),n.css("display","unset"),"edit_description_form"==o)t("#image-"+d).data("description",btoa(s));else if("edit_tags_form"==o){t("#image-"+d).data("tags",btoa(JSON.stringify(l)))}}).fail(function(t){alert("An error occured.")})}),t(document).on("add_tag","#add_tags input",function(){var a=this.value.replace(/[^a-zA-Z0-9\s\+\-\.\#]/gi,"");a&&t("<span/>",{html:a+'<input type="hidden" name="tags[]" value="'+a+'">',insertBefore:this}),this.value="",t("#add_tags_input").focus()}),t(document).on("add_tag",'input[name="search_term"]',function(){var a=this.value.replace(/[^a-zA-Z0-9\s\+\-\.\#]/gi,"");a&&t("<span/>",{html:a+'<input type="hidden" name="tags[]" value="'+a+'">',insertBefore:this}),this.value="",t(this).focus()}),t(document).on("keyup",'input[name="search_term"]',function(a){var e=t("#search_term_suggest");if(/(188|13)/.test(a.which))t(this).trigger("add_tag");else if(""!=this.value){var i=t(this).data("ajax")+"do=suggest_tag&text="+encodeURIComponent(this.value);t.ajax({type:"GET",url:i}).done(function(a){t(e).html(a).css("display","block")}).fail(function(t){alert("An error ocurred.")})}else t(e).html("").css("display","none")}),t(document).on("keyup","#add_tags_input",function(a){if(/(188|13)/.test(a.which))t(this).trigger("add_tag");else var e=t("#add_tags_suggest");if(""!=this.value){var i=t(this).data("ajax")+"do=suggest_tag&text="+encodeURIComponent(this.value);t.ajax({type:"GET",url:i}).done(function(a){t(e).html(a).css("display","block")}).fail(function(t){alert("An error ocurred.")})}else t(e).html("").css("display","none")}),t(document).on("click","#search_term_suggest div",function(){var a=t('input[name="search_term"]'),e=t(this).html();a.val(e),a.trigger("add_tag"),t("#search_term_suggest").html("").hide()}),t(document).on("click","#add_tags_suggest div",function(){var a=t("#add_tags_input"),e=t(this).html();a.val(e),a.trigger("add_tag"),t("#add_tags_suggest").html("").hide()}),t(document).on("click","#add_tags span",function(){confirm("Remove "+t(this).text()+"?")&&t(this).remove()}),t(document).on("click","#search span",function(){t(this).remove()}),t(document).on("submit","#search",function(a){a.preventDefault();var e=t(this).data("href"),i=t(this).children('input[name="search_term"]').val(),n=t(this).attr("method"),o=new FormData(this);t("#lightbox-loading").css("display","block");var s=t("input[name^=tags]").map(function(a,e){return t(e).val()}).get();i="";s.forEach(function(t,a){i=""==i?t:i+", "+t}),""!=i&&t.ajax({type:n,url:e,data:o,processData:!1,contentType:!1}).done(function(a){t("#container").html(a),t("#viewing").html("Search results: "+unescape(i)),t("#search").slideToggle("slow"),t("#lightbox-loading").css("display","none")}).fail(function(a){alert("An error ocurred."),t("#lightbox-loading").css("display","none")})}),t(document).on("click","#search-toggle",function(){t("#search").slideToggle("slow"),t('input[name="search_term"]').focus()})}),jQuery.fn.extend({live:function(t,a){return this.selector&&jQuery(document).on(t,this.selector,a),this}});